function showChartTooltip(e,t,a,o){$('<div id="tooltip" class="chart-tooltip">'+o+"</div>").css({position:"absolute",display:"none",top:t-40,left:e-40,border:"0px solid #ccc",padding:"2px 6px","background-color":"#fff",background:"#fff"}).appendTo("body").fadeIn(200)}function handleTooltip(e,t,a,o,i){if(o=o||0,$("#x").text(e.x.toFixed(o)),$("#y").text(e.y.toFixed(o)),t){if(previousPoint!=t.dataIndex){previousPoint=t.dataIndex,previousSeries=t.seriesIndex-1,$("#tooltip").remove();var l,n=(t.datapoint[0].toFixed(o),t.datapoint[1].toFixed(o),t.series.data[t.datapoint[0]][0]),r=0;"undefined"==typeof i?l=n+" : "+t.datapoint[1].toFixed(o)+" "+a:(l='<span class="caption-subject">'+n+"</span><br>"+i[previousSeries].label.trim()+" : "+t.datapoint[1].toFixed(0)+" "+a,r=22),showChartTooltip(t.pageX+10,t.pageY-r,t.datapoint[0],l)}}else $("#tooltip").remove(),previousPoint=null}require.config({baseUrl:"assets/global/plugins/",paths:{echarts:"echarts/js/echarts.min",chartDataTool:"echarts/js/extension/chartDataTool.min"}});var theme={backgroundColor:"#ffffff",color:["#61A5E8","#7ECF51","#EECB5F","#E4925D","#E16757","#9570E5","#605FF0","#85ca36","#1c9925","#0d8b5f","#0f9cd3","#2f7e9b","#2f677d","#9b7fed","#7453d6","#3b1d98","#27abb1","#017377","#015f63","#b86868","#5669b7","#e5aab4","#60b65f","#98d2b2","#c9c8bc","#45c3dc","#e17979","#5baa5a","#eaccc2","#ffaa74"],animationDuration:1500,title:{itemGap:8,textStyle:{fontWeight:"bold",color:"#666",fontSize:28},subtextStyle:{color:"#666"}},toolbox:{color:["rgb(38,185,139)","rgb(38,185,139)","rgb(38,185,139)","rgb(38,185,139)"]},tooltip:{trigger:"item"},grid:{borderWidth:0,y:80},categoryAxis:{axisLine:{lineStyle:{color:"#aaa",width:2}},boundaryGap:!0,splitLine:{show:!1,lineStyle:{color:["#ddd"],width:1}},nameTextStyle:{fontSize:16,color:"#555"},axisLabel:{textStyle:{color:"#222"}},splitArea:{show:!1,areaStyle:{color:["rgba(144,238,144,0.2)","rgba(255,255,255,0.05)"]}}},valueAxis:{axisLine:{show:!1,lineStyle:{color:"#bbb",width:1}},axisLabel:{textStyle:{color:"#222"}},nameTextStyle:{fontSize:16,color:"#555"},splitLine:{lineStyle:{color:["#ddd"],width:1,type:"dashed"},show:!0},splitArea:{show:!1,areaStyle:{color:["rgba(144,238,144,0.2)","rgba(255,255,255,0.05)"]}}},timeline:{lineStyle:{color:"rgb(38,185,139)"},controlStyle:{normal:{color:"rgb(38,185,139)"},emphasis:{color:"rgb(38,185,139)"}}},bar:{itemStyle:{normal:{barBorderRadius:1},emphasis:{barBorderRadius:1}}},line:{smooth:!1,symbol:"emptyCircle",symbolSize:9,itemStyle:{normal:{barBorderColor:"rgba(0,0,0,0)",label:{show:!0},lineStyle:{width:8,type:"solid",shadowColor:"rgba(0,0,0,0.3)",shadowBlur:5,shadowOffsetX:5,shadowOffsetY:5}},emphasis:{label:{show:!1}}},lineStyle:{normal:{width:8,type:"solid",shadowColor:"rgba(0,0,0,0.3)",shadowBlur:5,shadowOffsetX:5,shadowOffsetY:5}},showAllSymbol:!0},radar:{clickable:!0,legendHoverLink:!0,polarIndex:0,itemStyle:{normal:{label:{show:!1},lineStyle:{width:2,type:"solid",shadowColor:"rgba(0,0,0,0.3)",shadowBlur:1,shadowOffsetX:1,shadowOffsetY:1},areaStyle:{type:"default"}},emphasis:{label:{show:!1}}},splitLine:{lineStyle:{color:["#ddd"]}},symbolSize:5,symbol:"emptyCircle"},pie:{clickable:!0,legendHoverLink:!0,center:["50%","50%"],radius:[0,"75%"],clockWise:!0,startAngle:90,minAngle:0,selectedOffset:10,itemStyle:{normal:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!0,position:"inner",formatter:"{b}",textStyle:{fontSize:12}},labelLine:{show:!1,length:20,lineStyle:{width:1,type:"solid"}}},emphasis:{borderColor:"rgba(0,0,0,0)",borderWidth:1,label:{show:!1},labelLine:{show:!1,length:20,lineStyle:{width:1,type:"solid"}}}}},textStyle:{fontFamily:"微软雅黑, Arial, Verdana, sans-serif"}},mECharts=function(){function e(){var e=new Date,t=e.getFullYear(),a=jsRight("0"+(e.getMonth()+1),2),o=jsRight("0"+e.getDate(),2);return t+a+o}function t(){var e=new Date,t=e.getFullYear()-1,a=jsRight("0"+(e.getMonth()+1),2),o=jsRight("0"+e.getDate(),2);return t+a+o}function a(e){function t(t){n[t]!==!1&&(l[t]=o.init(document.getElementById("nocheck_statistics_"+t),e),l[t].setOption(n[t]),$("#nocheck_loading_"+t).addClass("display-none"),$("#nocheck_content_"+t).removeClass("display-none"))}if(o){var a=[getRootPath()+"/api/Api?Token="+config.TOKEN+"&ID=222&M=3&tstart="+s.start+"&tend="+s.end+"&tstart2="+d.start+"&tend2="+d.end+"&cache="+config.cache,getRootPath()+"/api/Api?Token="+config.TOKEN+"&ID=181&M=3&tstart="+s.start+"&tend="+s.end+"&tstart2="+s.start+"&tend2="+s.end+"&cache="+config.cache];$.ajax({url:a[0]}).done(function(l){r=0,l=$.parseJSON(l);var s={url:a[0],type:"bar",data:l};"undefined"!=typeof e.color&&(s.color=e.color),n[r]=i.getOption(s,o),n[r]!==!1&&(delete n[r].title,delete n[r].toolbox,delete n[r].dataZoom,n[r].grid.bottom="3%",n[r].legend.y=0,delete n[r].xAxis[0].name),t(r)}),$.ajax({url:a[1]}).done(function(l){r=1,l=$.parseJSON(l);var s={url:a[1],singleAxis:"time",type:"themeriver",data:l};"undefined"!=typeof e.color&&(s.color=e.color),n[r]=i.getOption(s,o),"undefined"!=typeof n[r].series&&(delete n[r].toolbox,n[r].title[2].x="center",n[r].title[2].y=40,n[r].title[2].y2=0,n[r].title[1].show=!1,n[r].title[3].show=!1,n[r].legend.orient="horizontal"),t(r)})}}var o,i,l=[],n=[],r=0;require(["echarts","chartDataTool"],function(e,t){o=e,i=t,a(theme)});var s={start:jsLeft(e(),6)+"01",end:jsLeft(e(),6)+"31"},d={start:jsLeft(t(),6)+"01",end:jsLeft(t(),6)+"31"};return{resize:function(){l[0].resize(),l[1].resize()}}}(),handleCounterup=function(e,t){$().counterUp&&e.counterUp({delay:10,time:t})},handleDashBoardNums=function(){var e=getRootPath(1)+"/api/Api?Token="+config.TOKEN+"&ID=168&M=3";$.ajax({url:e}).done(function(e){e=$.parseJSON(e),e.data[0].map(function(e,t){$(".dashboard-stat .number:nth("+t+")").attr("data-value",data2ThousandSeparator(e)).text(data2ThousandSeparator(e))}),e.data[0][4]&&bsTips("近期有机检异常产品，请注意!"),handleCounterup($(".top-info .number"),800)})}(),banknoteClass={"9602A":"font-green-jungle","103-G-2A":"font-green-jungle","9603A":"font-purple","103-G-3A":"font-purple","9604A":"font-blue","103-G-4A":"font-blue","9606A":"font-green-seagreen","103-G-6A":"font-green-seagreen","9607T":"font-red-flamingo","103-G-7T":"font-red-flamingo"},getHisQuaData=function(){function e(e,a){var o=getRootPath(1)+"/api/Api?Token="+config.TOKEN+"&ID="+e+"&M=3&cache="+config.cache,i="";$.ajax({url:o}).done(function(o){o=$.parseJSON(o),o.data.map(function(e){var t=e[0];i+='\n<div class="col-md-2 col-sm-2 col-xs-6"><div class="'+banknoteClass[t]+' font-sm">'+t+"</div>",i+='			<div class="uppercase font-hg '+banknoteClass[t]+'"><span class="number" data-counter="counterup" data-value='+e[1]+">"+e[1],i+='</span><span class="font-lg font-grey-mint">%</span>',i+="			</div></div>"}),0===o.rows&&(i='<h3 style="padding-left:20px;height:20px;">对应时间无质量信息</h3>'),a||($('[name="hisQuality"] .list-separated').html(i),handleCounterup($('[name="hisQuality"] .number'),300)),t[e-169]=i})}for(var t=[],a=0;3>a;a++)t[a]=e(a+169,a);$('[name="hisQuality"] label').on("click",function(){$('[name="hisQuality"] .list-separated').html(t[$(this).data("id")]),handleCounterup($('[name="hisQuality"] .number'),300)})}(),initQualityCharts=function(){var e=getRootPath(1)+"/api/Api?Token="+config.TOKEN+"&ID=172&M=0&cache="+config.cache;$.ajax({url:e}).done(function(e){e=$.parseJSON(e);var t={element:"passed_a_year_quality_static",padding:0,behaveLikeLine:!1,gridEnabled:!1,gridLineColor:!1,axes:!1,fillOpacity:1,ymin:70,data:e.data,lineColors:["#399a8c"],xkey:e.header[0].title,ykeys:[e.header[1].title],labels:[e.header[1].title],pointSize:0,lineWidth:0,hideHover:"auto",resize:!0};Morris.EventEmitter&&e.rows>0&&(dashboardMainChart=Morris.Area(t))})}(),previousPoint=null,olInfo,loadOLInfo=function(){var e=getRootPath(1)+"/api/Api?Token="+config.TOKEN+"&ID=173&M=3&cache=1440";$.ajax({url:e}).done(function(e){e=$.parseJSON(e),olInfo={hardDisk:[],sqlSvr:[],data_uploads:[],realQuality:[]},e.data.map(function(e){olInfo.hardDisk.push([e[0],e[2]]),olInfo.sqlSvr.push([e[0],Number.parseFloat(e[3].replace("MB",""))/1e3]),olInfo.data_uploads.push([e[0],e[4]]),5!=e[5]&&olInfo.realQuality.push([e[0],e[1]])}),refreshRealQuality(olInfo.realQuality),initFlotCharts()})}(),initNoteAnanyCharts=function(){var e=getRootPath(1)+"/api/Api?Token="+config.TOKEN+"&ID=175&M=0&cache="+config.cache;$.ajax({url:e}).done(function(e){if(e=$.parseJSON(e),e.rows>0){var t={element:"noteAnany_static",behaveLikeLine:!1,fillOpacity:1,stacked:0,ymin:95,ymax:100,data:e.data,xkey:e.header[0].title,ykeys:[e.header[1].title,e.header[2].title,e.header[3].title],labels:[e.header[1].title,e.header[2].title,e.header[3].title],hideHover:!0,resize:!0};Morris.EventEmitter&&(dashboardMainChart=Morris.Bar(t))}})}(),refreshRealQuality=function(e){function t(e,t){t=t||0;var a=t?"#f89f9f":"#893a7c";return[{data:e,lines:{fill:.9,lineWidth:0},color:[a]},{data:e,yaxis:1,points:{show:!0,fill:!0,radius:5,fillColor:a,lineWidth:3},color:"#fff",shadowSize:0}]}$("#real_quality_loading").hide(),$("#real_quality_content").show();var a,o=0,i=function(e){var a=getRootPath(1)+"/api/Api?Token="+config.TOKEN+"&ID=174&M=3&machine="+e+"&cache="+config.cache,o=ReadData(a);return t(o.data,1)},l={xaxis:{tickLength:0,tickDecimals:0,mode:"categories",min:0,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"},show:!1},yaxis:{ticks:5,tickDecimals:0,tickColor:"#eee",max:100,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderColor:"#eee",borderWidth:1},legend:{show:!1}};$("#real_quality_statistics").bind("plothover",function(e,t,a){handleTooltip(t,a,"%",2)}),$("#real_quality_statistics").bind("plotclick",function(t,n,r){var s;o?(s=a[0].data[r.dataIndex][0],bsTips("车号追溯功能加入后跳转至"+s+"详细信息",2)):(s=e[r.dataIndex][0],$('[name="curQuality_title"]').text(s),a=i(s),$.plot($("#real_quality_statistics"),a,l),o++)}),$('[name="curQuality"]').on("click",function(){$.plot($("#real_quality_statistics"),t(e),l),$('[name="curQuality_title"]').text("实时质量"),o=0}),$('[name="curQuality"]').click()},initFlotCharts=function(){function e(e,t){return[{data:t,yaxis:1,lines:{fill:.6,lineWidth:0},color:["#f89f9f"],label:"&nbsp;数据库大小&nbsp;"},{data:t,yaxis:1,points:{show:!0,fill:!0,radius:5,fillColor:"#f89f9f",lineWidth:3},color:"#fff",shadowSize:0},{data:e,yaxis:2,lines:{fill:.6,lineWidth:0},color:["#92e9dc"],label:"&nbsp;硬盘可用量&nbsp;"},{data:e,yaxis:2,points:{show:!0,fill:!0,radius:5,fillColor:"#92e9dc",lineWidth:3},color:"#fff",shadowSize:0}]}function t(e){return[{data:e,lines:{fill:.3,lineWidth:0},color:["#BAD9F5"]},{data:e,points:{show:!0,fill:!0,radius:4,fillColor:"#9ACAE6",lineWidth:2},color:"#9ACAE6",shadowSize:1,label:"数据上传"},{data:e,lines:{show:!0,fill:!1,lineWidth:3},color:"#9ACAE6",shadowSize:0}]}if(jQuery.plot){var a=e(olInfo.hardDisk,olInfo.sqlSvr),o=t(olInfo.data_uploads);if(0!==$("#site_statistics").size()){$("#site_statistics_loading").hide(),$("#site_statistics_content").show();$.plot($("#site_statistics"),a,{xaxis:{tickLength:0,tickDecimals:0,mode:"categories",min:0,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"},show:!1},yaxes:[{ticks:5,tickDecimals:0,tickColor:"#eee",min:0,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},{ticks:5,tickDecimals:0,tickColor:"#eee",position:"right",font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}}],grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderColor:"#eee",borderWidth:1},legend:{show:!0,noColumns:!1,container:"#site_statistics_legend"}});$("#site_statistics").bind("plothover",function(e,t,o){handleTooltip(t,o,"GB",0,a)})}if(0!==$("#data_upload").size()){$("#data_upload_loading").hide(),$("#data_upload_content").show()}$.plot($("#data_upload"),o,{xaxis:{tickLength:0,tickDecimals:0,mode:"categories",min:0,font:{lineHeight:18,style:"normal",variant:"small-caps",color:"#6F7B8A"},show:!1},yaxis:{ticks:5,tickDecimals:0,tickColor:"#eee",font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"},max:20},grid:{hoverable:!0,clickable:!0,tickColor:"#eee",borderColor:"#eee",borderWidth:1},legend:{show:!1,noColumns:!1,container:"#data_upload_legend"}});$("#data_upload").bind("plothover",function(e,t,a){handleTooltip(t,a,"车")}),$("#data_upload").bind("mouseleave",function(){$("#tooltip").remove()})}},processQCDashboard=function(){var e=!1,t=function(){var e=getRootPath(1)+"/api/Api?Token="+config.TOKEN+"&ID=176&M=3",t=ReadData(e),a=[];t.data.map(function(e){a.push([e[0],e[3]])});$.plot($("#statistics_2"),[{data:a,lines:{fill:.9,lineWidth:0},color:["#556"],label:"过程质量评分"},{data:a,yaxis:1,points:{show:!0,fill:!0,radius:5,fillColor:"#556",lineWidth:3},color:"#fff",shadowSize:0}],{xaxis:{tickLength:0,tickDecimals:0,mode:"categories",min:2,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},yaxis:{ticks:4,tickDecimals:0,tickColor:"#f0f0f0",min:96,max:100,font:{lineHeight:14,style:"normal",variant:"small-caps",color:"#6F7B8A"}},grid:{backgroundColor:{colors:["#fff","#fff"]},borderWidth:1,borderColor:"#f0f0f0",margin:0,minBorderMargin:0,labelMargin:20,hoverable:!0,clickable:!0,mouseActiveRadius:6},legend:{show:!0}});$("#statistics_2").bind("plothover",function(e,t,a){handleTooltip(t,a,"分",2)})};return{init:function(){$("#process_quality_cut_tab").on("shown.bs.tab",function(a){e||(t(),e=!0)}),$("#process_quality_offline_tab").on("shown.bs.tab",function(e){bsTips("即将添加")})}}}();jQuery(document).ready(function(){UIIdleTimeout.init(),initDom(),processQCDashboard.init(),$(".theme-panel").hide(),hideSidebarTool()}),jQuery(window).resize(function(){HeadFix(),mECharts.resize()});
var Login=function(){function e(){var e=getRootPath(1)+"/DataInterface/Api?Token="+r.TOKEN+"&ID=163&M=3&cache=14400",t=ReadData(e);InitSelect("department",t),SetSelectVal("department",0),n=!0}const r={TOKEN:"79d84495ca776ccb523114a2120e273ca80b315b"};var t=function(){function e(){if($(".login-form").validate().form()){var e=getRootPath(1)+"/welcome/trylogin",r={username:$('.login-form input[name="username"]').val(),password:$('.login-form input[name="password"]').val()};$.post(e,r,function(e,r){if("success"==r){var t=jQuery.parseJSON(e);if(localStorage.settings_default_menu=t.segment_html,2===t.type||3===t.type||4===t.type||7===t.type)t.type=0;else if(5===t.type||1===t.type)t.type=1;else if(6===t.type)t.type=2;else{if(9===t.type){var o="undefined"==typeof localStorage.lastUrl?getRootPath(1)+"/settings/menu":localStorage.lastUrl;return void(window.location.href=o)}t.type=3}infoTips(t.message,t.type,"#bootstrap_alerts_demo")}else infoTips("登录验证失败，请稍后重试或联系管理员!",0,"#bootstrap_alerts_demo")})}return!1}$(".login-form").validate({errorElement:"span",errorClass:"help-block",focusInvalid:!1,rules:{username:{required:!0},password:{required:!0},remember:{required:!1}},messages:{username:{required:"用户名不能为空."},password:{required:"密码不能为空."}},invalidHandler:function(e,r){$(".alert-danger",$(".login-form")).show()},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,r){"tnc"==r.attr("name")?e.insertAfter($("#forget-password")):1===r.closest(".input-icon").size()?e.insertAfter(r.closest(".input-icon")):e.insertAfter(r)},submitHandler:function(e){}}),$(".login-form input").keypress(function(r){13==r.which&&e()}),$(".login-form button").on("click",function(){e()})},o=function(){function e(){if($(".forget-form").validate().form()){var e=getRootPath(1)+"/welcome/resetpassword",r={email:$('.forget-form input[name="email"]').val(),username:$('.forget-form input[name="username"]').val(),password:$('.forget-form input[name="password"]').val()};$.post(e,r,function(e,r){if("success"==r){var t=jQuery.parseJSON(e);2===t.type||3===t.type||4===t.type||7===t.type?t.type=0:5===t.type?t.type=1:6===t.type?t.type=2:t.type=3,infoTips(t.message,t.type,"#bootstrap_alerts_demo3")}else infoTips("登录验证失败，请稍后重试或联系管理员!",0,"#bootstrap_alerts_demo3")})}return!1}$(".forget-form").validate({errorElement:"span",errorClass:"help-block",focusInvalid:!1,ignore:"",rules:{username:{required:!0},password:{required:!0},email:{required:!0,email:!0}},messages:{email:{required:"Email是您重置密码的唯一凭证."}},invalidHandler:function(e,r){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,r){"tnc"==r.attr("name")?e.insertAfter($("#register_tnc_error")):1===r.closest(".input-icon").size()?e.insertAfter(r.closest(".input-icon")):e.insertAfter(r)},submitHandler:function(e){}}),$(".forget-form input").keypress(function(e){return 13==e.which?($(".forget-form").validate().form()&&$(".forget-form").submit(),!1):void 0}),$(".forget-form button").on("click",function(){e()}),jQuery("#forget-password").click(function(){jQuery(".login-form").hide(),jQuery(".forget-form").show()}),jQuery("#back-btn").click(function(){jQuery(".login-form").show(),jQuery(".forget-form").hide()})},n=!1,s=function(){function r(){if($(".register-form").validate().form()){var e=getRootPath(1)+"/welcome/register",r={fullname:$(".register-form input:nth(0)").val(),email:$(".register-form input:nth(1)").val(),phone:$(".register-form input:nth(2)").val(),username:$(".register-form input:nth(3)").val(),password:$(".register-form input:nth(4)").val(),department:$(".register-form select").val()};$.post(e,r,function(e,r){if("success"==r){var t=jQuery.parseJSON(e);2===t.type||3===t.type||4===t.type||7===t.type?t.type=0:5===t.type?t.type=1:6===t.type?t.type=2:t.type=3,infoTips(t.message,t.type,"#bootstrap_alerts_demo2")}else infoTips("登录验证失败，请稍后重试或联系管理员!",0,"#bootstrap_alerts_demo2")})}return!1}$(".register-form").validate({errorElement:"span",errorClass:"help-block",focusInvalid:!1,ignore:"",rules:{fullname:{required:!0},email:{required:!0,email:!0},phone:{required:!0},role:{required:!0},username:{required:!0},password:{required:!0},rpassword:{equalTo:"#register_password"}},invalidHandler:function(e,r){},highlight:function(e){$(e).closest(".form-group").addClass("has-error")},success:function(e){e.closest(".form-group").removeClass("has-error"),e.remove()},errorPlacement:function(e,r){"tnc"==r.attr("name")?e.insertAfter($("#register_tnc_error")):1===r.closest(".input-icon").size()?e.insertAfter(r.closest(".input-icon")):e.insertAfter(r)},submitHandler:function(e){}}),$(".register-form input").keypress(function(e){13==e.which&&r()}),$(".register-form button").on("click",function(){r()}),jQuery("#register-btn").click(function(){n||e(),jQuery(".login-form").hide(),jQuery(".register-form").show()}),jQuery("#register-back-btn").click(function(){jQuery(".login-form").show(),jQuery(".register-form").hide()})};return{init:function(){t(),o(),s()}}}();jQuery(document).ready(function(){Login.init()});